<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>视频播放</title>
  <style>
    body { background: #f4f4f4; text-align: center; padding: 40px; font-family: "Segoe UI", sans-serif; }
    #main { background: #fff; display: inline-block; padding: 30px 50px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    #msg { color: red; margin-bottom: 20px; }
    .video-container { max-width: 900px; margin: auto; position: relative; padding-top: 56.25%; }
    .plv-player-wrap { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div id="main">
    <div id="msg"></div>
    <div id="video-area" style="display:none;">
      <h2>视频内容</h2>
      <div class="video-container">
        <div id="plv_g531ebf57e9887dc958f0135f0bab1e9_g" class="plv-player-wrap"></div>
      </div>
    </div>
  </div>
  <script src="https://player.polyv.net/resp/vod-player/latest/player.js"></script>
  <script>
    // 获取 token 和密码
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const pwd = params.get('pwd');
    const msgDiv = document.getElementById('msg');
    if (!token || !pwd) {
      msgDiv.innerText = '非法访问，请从首页进入';
    } else {
      const usedToken = localStorage.getItem('video_token_used_' + token);
      const usedPwd = localStorage.getItem('video_pwd_used_' + pwd);
      if (usedToken === null) {
        msgDiv.innerText = '链接已失效或非法访问（token无效）';
      } else if (usedPwd === null) {
        msgDiv.innerText = '链接已失效或非法访问（密码无效）';
      } else if (usedToken === '1' || usedPwd === '1') {
        msgDiv.innerText = '本链接或密码已访问过，不能重复访问';
      } else {
        // 标记为已访问
        localStorage.setItem('video_token_used_' + token, '1');
        localStorage.setItem('video_pwd_used_' + pwd, '1');
        document.getElementById('video-area').style.display = '';
        // 初始化播放器
        polyvPlayer({
          'wrap':'#plv_g531ebf57e9887dc958f0135f0bab1e9_g',
          'width':'100%',
          'height':'100%',
          'vid': 'g531ebf57e9887dc958f0135f0bab1e9_g',
          'playsafe': ''
        });
      }
    }
  </script>
</body>
</html>
